---
title: "Visualisierungen der Suicide Daten von 1985-2016"
author: "Philip Dalheimer, Thomas Jäger"
output:
  html_notebook: default
  html_document:
    df_print: paged
  pdf_document: default
---

### Ausgangssituation

In diesem Projekt beschäftigen wir uns mit der Visualisierung des Datensatz "Suicide Rates Overview von 1985-2016".
Der Datensatz besteht ursprünglich aus vier anderen Datensätzen, die zusammengefügt wurden, um mögliche Zusammenhänge zu erkennen.  
  Zu finden ist er unter https://www.kaggle.com/russellyates88/suicide-rates-overview-1985-to-2016


**References**

United Nations Development Programm. (2018). Human development index (HDI). Retrieved from  
  http://hdr.undp.org/en/indicators/137506


World Bank. (2018). World development indicators: GDP (current US$) by country:1985 to 2016. Retrieved from 
  http://databank.worldbank.org/data/source/world-development-indicators#

  
  [Szamil]. (2017). Suicide in the Twenty-First Century [dataset]. Retrieved from  
        https://www.kaggle.com/szamil/suicide-in-the-twenty-first-century/notebook
    
   
  World Health Organization. (2018). Suicide prevention. Retrieved from  
          http://www.who.int/mental_health/suicide-prevention/en/


### Unsere Ziele

### Beschreibung der Daten

### Beobachtungen und Bereinigen der Daten

Beim betrachten der master.csv sind uns folgende Missstände aufgefallen, die wir gerne bereinigen würden:

* 7 Länder haben nur <= 3 Jahre an Daten
* 2016 hatten nur wenige Länder Daten -> Jahr nicht betrachten
* HDI for year mehr als 2/3 fehlende Werte
* Africa hat sehr wenige Länder, die Daten haben
* Kontinente mit dem Package countrycode hinzugefügt

```{r}
library(tidyverse)
library(countrycode)
# load data

data <- read_csv("../data/master.csv")

# data cleaning
# entfernen der Spalten HDI for year und suicides/100k pop
# umbennen der anderern Spalten

data <- data %>% 
  select(-c(`HDI for year`)) %>%
  rename(gdp_for_year = `gdp_for_year ($)`, 
         gdp_per_capita = `gdp_per_capita ($)`, 
         country_year = `country-year`) %>%
  as.data.frame()

# das Jahr 2016 aus data werfen

data <- data %>%
  filter(year != 2016) %>%
  select(-country_year)

# Jahre mit <= 3 Jahren von Daten rauswerfen

minimum_years <- data %>%
  group_by(country) %>%
  summarize(rows = n(),
            years = rows / 12) %>%
  arrange(years)

data <- data %>%
  filter(!(country %in% head(minimum_years$country, 7)))

# das datenset ein wenig kleiner machen
data$age <- gsub(" years", "", data$age)        # gsub um Strings zu replacen
data$sex <- ifelse(data$sex == "male", "Male", "Female")

# continent data
data$continent <- countrycode(sourcevar = data[, "country"],
                              origin = "country.name",
                              destination = "continent")



# nominale daten (country, sex, continent)
data_nominal <- c('country','sex','continent')
data[data_nominal] <- lapply(data[data_nominal], function(x){factor(x)})


# ordinale daten (alter, generation)
data$age <- factor(data$age, 
                   ordered = T,
                   levels = c("5-14",
                              "15-24",
                              "25-34",
                              "35-54",
                              "55-74",
                              "75+"))

# generation ordinal
data$generation <- factor(data$generation, 
                   ordered = T, 
                   levels = c("G.I. Generation", 
                              "Silent",
                              "Boomers", 
                              "Generation X", 
                              "Millenials", 
                              "Generation Z"))


data <- as_tibble(data)  # TO-DO as_tibble erklären


# global average
global_average <- (sum(as.numeric(data$suicides_no)) / sum(as.numeric(data$population))) * 100000


# die finalen daten anschauen
glimpse(data)


```

### Globale Analyse

```{r}
data %>%
  group_by(year) %>%
  summarize(population = sum(population), 
            suicides = sum(suicides_no), 
            suicides_per_100k = (suicides / population) * 100000) %>%
  ggplot(aes(x = year, y = suicides_per_100k)) + 
  geom_line(col = "deepskyblue3", size = 1) + 
  geom_point(col = "deepskyblue3", size = 2) + 
  geom_hline(yintercept = global_average, linetype = 2, color = "grey35", size = 1) +     # global average als gedoddete linie
  labs(title = "Global Suicides (per 100k)",
       subtitle = "Trend over time, 1985 - 2015.",
       x = "Year", 
       y = "Suicides per 100k Population") + 
  scale_x_continuous(breaks = seq(1985, 2015, 2)) + 
  scale_y_continuous(breaks = seq(10, 20))
```
*Abbildung 1: Suicides per 100k per Year. Gestrichelte Linie ist der globale Durchschnitt.*

